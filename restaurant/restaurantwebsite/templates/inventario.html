<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script type="text/javascript" src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/localization/messages_es.min.js"></script>
    
    <title>Inventario</title>
</head>
<body>

  <style>

    body{
      background: url("{% static 'images/pizzab14.jpg' %}") center no-repeat;
    background-size: cover;

    }

  </style>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark" id="navbar">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Pizza Wave</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
    <li class="nav-item">
    <a class="nav-link active" aria-current="page" href="/usuario">Inicio</a>
    </li>
  
  
    {% if request.session.username %}
  
    <div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
    <ul class="navbar-nav">
      <li class="nav-item dropdown">
    
    <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vista Empleados
    </a>
    <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
    <li class="nav-item">
      <a class="nav-link" href="/cargoregister">Registros de Cargos del Empleado</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-link" href="/empleado">Registro de Empleados</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-link" href="/tipodocumentoemp">Registro de Tipo De Documento</a>
    </li>


    <li class="nav-item">
      <a class="nav-link" href="/departamentohome">Registro de Departamento</a>
    </li>

    <li class="nav-item">
      <a class="nav-link" href="/puestos">Control de Puestos</a>
    </li>

    <li class="nav-item">
      <a class="nav-link" href="/sucursal">Control de sucursal</a>
    </li>

    </ul>
  
    </li>
    </ul>
  </div>
    
  
  
    <div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
    <ul class="navbar-nav">
      <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      Vista Usuarios
      </a>
      <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
    
          <li class="nav-item">
              <a class="nav-link" href="/registrousuarios">Usuarios</a>
            </li>
    
            


      <li class="nav-item">
      <a class="nav-link" href="/pedidos">Pedidos</a>
      </li>


      <li class="nav-item">
          <a class="nav-link" href="/facturacion">Factura</a>
        </li>
      

        <li class="nav-item">
          <a class="nav-link" href="/impuesto">Impuestos</a>
        </li>


      <li class="nav-item">
        <a class="nav-link" href="/estadopedido">Estado Pedido</a>
        </li>
  


          <li class="nav-item">
            <a class="nav-link" href="/reservaciones">Registros de Reservaciones</a>
            </li>



          <li class="nav-item">
            <a class="nav-link" href="/promociones">Registros de Promociones</a>
            </li>

            



          <li class="nav-item">
            <a class="nav-link" href="/metodopago">Metodo de Pago</a>
            </li>



            <li class="nav-item">
              <a class="nav-link" href="/sartabla">SAR</a>
              </li>

    
      </ul>
      </li>
    </ul>
    </div>



    <div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
      <ul class="navbar-nav">
      <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
        Vista productos
      </a>
      <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
    
        <li class="nav-item">
        <a class="nav-link" href="/categoria">Registros de categoria</a>
        </li>
    
        <li class="nav-item">
        <a class="nav-link" href="/almacen">Registros del almacen </a>
        </li>

        <li class="nav-item">
        <a class="nav-link" href="/familiaproducto">Registros de familia producto</a>
        </li>

        <li class="nav-item">
        <a class="nav-link" href="/menutabla">Registros del Menu</a>
        </li>


        <li class="nav-item">
          <a class="nav-link" href="/historicomenutabla">Registros Historicos del Menu</a>
          </li>

        <li class="nav-item">
        <a class="nav-link" href="/elaboracion">Registros de Elaboracion</a>
        </li>


        <li class="nav-item">
        <a class="nav-link" href="/recetatablaregistros">Registros de Receta</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="/inventario">Registros de inventario</a>
          </li>

        <li class="nav-item">
          <a class="nav-link" href="/productos">Registros de Productos</a>
          </li>

          <li class="nav-item">
              <a class="nav-link" href="/historicoproducto">Registros Historicos de Productos</a>
              </li>

          
          <li class="nav-item">
              <a class="nav-link" href="/provedores">Registros de Proveedores</a>
              </li>
    

    
      </ul>
      </li>
      </ul>
      </div>
    
  
  
  
  
    <li class="nav-item">
    <a class="nav-link" href="/signout">Cerrar Sesion</a>
    </li>
  
  
  
   
    {% else %}
    
    <li class="nav-item">
    <a class="nav-link" href="/login_user">Iniciar Sesion</a>
    </li>
     
  
       <li class="nav-item">
    <a class="nav-link" href="/signup">Registrarse</a>
    </li>
  
  
    
    {% endif %}
    
    
  
  
  
    
  
       <li class="nav-item">
    <a class="nav-link" href="/menu">Menu</a>
    </li>
  
    
  
    <div class="collapse navbar-collapse" id="navbarNav">
    <li class="nav-item">
      <a class="nav-link desactivated">{{request.session.username}}</a>
    </li>
    </div>
  
  
    </ul>
    </div>
  </div>
  </nav>

    
    <h1>CONTROL DE INVENTARIO</h1>


    <table id="miTabla">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre del Producto</th>
            <th>Cantidad Actual</th>
            <th>Cantidad Minima</th>
            <th>Cantidad Maxima</th>
            <th>Unidad de Medida</th>
            <th>ACCIONES</th>
        </tr>
        </thead>
        <tbody>
            {% for i in inv %}
          <tr>
            <td>{{i.id_inventario}}</td>
            <td>{{i.producto}}</td>
            <td>{{i.cantidad_actual}}</td>
            <td>{{i.cantidad_minima}}</td>
            <td>{{i.cantidad_maxima}}</td>
            <td>{{i.unidad_de_medida}}</td>
            <td>
                
  <!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editarmodalinventario-{{forloop.counter}}">
    EDITAR
  </button>
                <a href="/eliminarinventario/{{i.id_inventario}}" class="btn btn-danger">ELIMINAR</a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
      </table>
      


      <!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#agregarmodal">
    Agregar Nuevo Inventario
  </button>
  
  <!-- Modal -->
  <div class="modal fade" id="agregarmodal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Agregar Nuevo Inventario</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="Myform" action="{% url 'agregarinventario' %}" method="POST">
            {% csrf_token %}
                    <!-- Name input -->
                    <div class="form-outline mb-4">
                      <label class="form-label" for="name2">ID</label>
                        <input type="text" name="id_inventario" id="id_inventario" class="form-control" />
                     
                    </div>

                    <!-- Email input -->
                    <div class="form-outline mb-4">
                      <label class="form-label" for="producto">Producto</label>  
                    <select class="form-control" name="producto" id="producto">
                      <option value=""> Selecciona un Producto </option>
                      {% for p in pro %}
                    <option value="{{p.nombre_producto}}">{{p.nombre_producto}}</option>
                    {% endfor %}
                    </select>    
                  
                    </div>

                    <!-- password input -->
                    <div class="form-outline mb-4">
                      <label class="form-label" for="cantidad_actual">Cantidad Actual</label>
                        <input type="number" name="cantidad_actual" id="cantidad_actual" class="form-control" />

                    </div>


                    <!-- password input -->
                    <div class="form-outline mb-4">
                      <label class="form-label" for="password2">Cantidad Minima</label>
                        <input min="0" type="number" name="cantidad_minima" id="cantidad_minima" class="form-control" />

                    </div>

                    <!-- password input -->
                    <div class="form-outline mb-4">
                      <label class="form-label" for="cantidad_maxima">Cantidad Maxima</label>
                        <input min="0" type="number" name="cantidad_maxima" id="cantidad_maxima" class="form-control" />

                    </div>

                    <!-- password input -->
                    <div class="form-outline mb-4">
                        <label class="form-label" for="password2">Unidad de Medida</label>

                        <select class="form-control" name="unidad_de_medida" id="unidad_de_medida">
                          <option value="" selected disabled>Selecciona una Unidad de Medida</option>
                            <option value="Lbs">Libras</option>
                            <option value="Kgs">Kilogramos</option>
                            <option value="Gr">Gramos</option>
                        </select>
                    </div>








        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
    </form>

    </div>
    </div>
  </div>




  <!-- Modal -->
  {% for i in inv %}
  <div class="modal fade" id="editarmodalinventario-{{forloop.counter}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Editar Inventario</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
       

            <form action="/editarinventario/{{i.id_inventario}}" method="POST">
                {% csrf_token %}
                        <!-- Name input -->
                        <div class="form-outline mb-4">
                            <input type="number" value="{{i.id_inventario}}" name="id_inventario" id="id_inventario" class="form-control" />
                            <label class="form-label" for="name2">ID</label>
                        </div>
    
    
                        <div class="form-outline mb-4">

                          <select class="form-control" name="producto" id="producto">
                            <option value="{{i.producto}}">{{i.producto}}</option>
                            {% for p in pro %}
                          <option value="{{p.nombre_producto}}">{{p.nombre_producto}}</option>
                          {% endfor %}
                          </select>    
                          <label class="form-label" for="producto">Producto</label>                  
                          </div>
    
                        <!-- password input -->
                        <div class="form-outline mb-4">
                            <input type="number" value="{{i.cantidad_actual}}" name="cantidad_actual" id="password2" class="form-control" />
                            <label class="form-label" for="password2">Cantidad Actual</label>
                        </div>
    
    
                        <!-- password input -->
                        <div class="form-outline mb-4">
                            <input type="number" value="{{i.cantidad_minima}}" name="cantidad_minima" id="password2" class="form-control" />
                            <label class="form-label" for="password2">Cantidad Minima</label>
                        </div>
    
                        <!-- password input -->
                        <div class="form-outline mb-4">
                            <input type="number" value="{{i.cantidad_maxima}}" name="cantidad_maxima" id="password2" class="form-control" />
                            <label class="form-label" for="password2">Cantidad Maxima</label>
                        </div>
    
                        <!-- password input -->
                        <div class="form-outline mb-4">
                            <label class="form-label" for="password2">Unidad de Medida</label>
    
                            <select class="form-control" name="unidad_de_medida" id="">
                                <option value="{{i.unidad_de_medida}}" selected>{{i.unidad_de_medida}}</option>
                                <option value="Lbs">Libras</option>
                                <option value="Kgs">Kilogramos</option>
                                <option value="Gr">Gramos</option>
                            </select>
                        </div>
    
    
    
    



        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>


    </form>
      </div>
    </div>
  </div>

  {% endfor %}


    <script>

$(document).ready( function () {
    $('#miTabla').DataTable({
        language: {
            url: 'https://cdn.datatables.net/plug-ins/1.11.4/i18n/es_es.json'
        }
    });
});



$("#Myform").validate({
  rules: {
    id_inventario: {
      required: true,
      noSpaceafterletters:true,
    },
    producto: {
      required: true,
    },
    cantidad_actual: {
      required: true,
      greaterThanMin: true,
      lessThanOrEqualMax: true,

    },
    cantidad_minima: {
      required: true,
      lessThanOrEqualActual: true,
    },
    cantidad_maxima: {
      required: true,
      greaterThanOrEqualActual: true,
    },
    unidad_de_medida: {
      required: true,
    },
  },
  messages: {
    id_inventario: {
      required: "Debes poner un ID",
    },
    producto: {
      required: " selecciona un",
    },
    cantidad_actual: {
      required: "Debes ingresar la cantidad actual del producto seleccionado",

    },
    cantidad_minima: {
      required: "Debes ingresar la cantidad mínima del producto seleccionado",
        
    },
    cantidad_maxima: {
      required: "Debes ingresar la cantidad máxima del producto seleccionado",
        
    },
    unidad_de_medida: {
      required: "Debes seleccionar una unidad de medida del producto",
    },
  },
  submitHandler: function(form) {
    $("#mensaje-confirmacion").show();
    form.submit();
  }
});

	
	// Regla personalizada para validar el campo de Descripciion


  jQuery.validator.addMethod("noSpaceafterletters", function(value, element) { 
        return this.optional(element) || /^[^\s]+\s*[^\s]*$/.test(value);
    }, "No letras ni digitos despues de espacios por favor");
    



	jQuery.validator.addMethod("noSpace", function(value, element) { 
		return value == '' || value.trim().length != 0;  
	}, "No espacios Porfavor Eso no se Hace Aqui");
	
	// Regla personalizada para validar el campo de nombre_cargo
	$.validator.addMethod("noRepetidos", function(value, element) {
	  return this.optional(element) || !/(.)\1+/.test(value);
	}, "No se permiten caracteres repetidos en este campo");
	
	jQuery.validator.addMethod("noSpaceafterletters", function(value, element) { 
    return this.optional(element) || /^[^\s]+\s*[^\s]*$/.test(value);
}, "No letras ni digitos despues de espacios por favor");


// Regla personalizada para validar que la cantidad mínima sea menor o igual que la cantidad actual
$.validator.addMethod("lessThanOrEqualActual", function (value, element) {
  return parseInt(value) <= parseInt($("#cantidad_actual").val()); 
}, "La cantidad mínima debe ser menor o igual que la cantidad actual.");

// Regla personalizada para validar que la cantidad actual sea mayor que la cantidad mínima pero no mayor que la cantidad máxima
$.validator.addMethod("greaterThanMin", function (value, element) {
  var current = parseInt(value);
  var min = parseInt($("#cantidad_minima").val());
  var max = parseInt($("#cantidad_maxima").val());
  return current >= min && current <= max || current <= min;
}, "La cantidad actual debe ser mayor o igual que la cantidad mínima y menor o igual que la cantidad máxima.");


// Regla personalizada para validar que la cantidad actual sea menor o igual que la cantidad máxima
$.validator.addMethod("lessThanOrEqualMax", function (value, element) {
  return parseInt(value) <= parseInt($("#cantidad_maxima").val());
}, "La cantidad actual debe ser menor o igual que la cantidad máxima.");

// Regla personalizada para validar que la cantidad máxima sea mayor o igual que la cantidad actual
$.validator.addMethod("greaterThanOrEqualActual", function (value, element) {
  return parseInt(value) >= parseInt($("#cantidad_actual").val());
}, "La cantidad máxima debe ser mayor o igual que la cantidad actual.");





    </script>

</body>
</html>