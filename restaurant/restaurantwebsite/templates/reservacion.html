
<!DOCTYPE html>
{% load static %}
<html>

<title>Reservaciones</title>
<head>
    <head>
        <style>
            #restaurante {
                width: 400px;
                height: 400px;
              
                position: relative;
                margin: 0 auto;
            }
            
            .mesa {
                width: 50px;
                height: 50px;
                background-color: #ccc;
                color: white;
                text-align: center;
                line-height: 50px;
                border-radius: 5px;
                position: absolute;
                cursor: move;
            }


            
        </style>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>

        <link rel="stylesheet" href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.min.css
        ">
        <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.js"></script>



 
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/localization/messages_es.min.js"></script>
        




<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pdf-lib@^1.20.0/dist/pdf-lib.min.js"></script>

        <body>

          <style>

            body{
              background: url("{% static 'images/pizzab14.jpg' %}") center no-repeat;
            background-size: cover;
          
            }
          
            </style>
           
           <nav class="navbar navbar-expand-lg navbar-dark bg-dark" id="navbar">
            <div class="container-fluid">
              <a class="navbar-brand" href="#">Pizza Wave</a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav">
              <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="/usuario">Inicio</a>
              </li>
            
            
              {% if request.session.username %}
            
              <div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
              <ul class="navbar-nav">
                <li class="nav-item dropdown">
              
              <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Vista Empleados
              </a>
              <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
              <li class="nav-item">
                <a class="nav-link" href="/cargoregister">Registros de Cargos del Empleado</a>
              </li>
              
              <li class="nav-item">
                <a class="nav-link" href="/empleado">Registro de Empleados</a>
              </li>
              
              <li class="nav-item">
                <a class="nav-link" href="/tipodocumentoemp">Registro de Tipo De Documento</a>
              </li>
          
          
              <li class="nav-item">
                <a class="nav-link" href="/departamentohome">Registro de Departamento</a>
              </li>
          
              <li class="nav-item">
                <a class="nav-link" href="/puestos">Control de Puestos</a>
              </li>
          
              <li class="nav-item">
                <a class="nav-link" href="/sucursal">Control de sucursal</a>
              </li>
          
              </ul>
            
              </li>
              </ul>
            </div>
              
            
            
              <div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
              <ul class="navbar-nav">
                <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Vista Usuarios
                </a>
                <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
              
                    <li class="nav-item">
                        <a class="nav-link" href="/registrousuarios">Usuarios</a>
                      </li>
              
                      


                <li class="nav-item">
                <a class="nav-link" href="/pedidos">Pedidos</a>
                </li>
          
          
                <li class="nav-item">
                    <a class="nav-link" href="/facturacion">Factura</a>
                  </li>
                

                  <li class="nav-item">
                    <a class="nav-link" href="/impuesto">Impuestos</a>
                  </li>
        


                <li class="nav-item">
                  <a class="nav-link" href="/estadopedido">Estado Pedido</a>
                  </li>
            
          
          
                    <li class="nav-item">
                      <a class="nav-link" href="/reservaciones">Registros de Reservaciones</a>
                      </li>
          
          
          
                    <li class="nav-item">
                      <a class="nav-link" href="/promociones">Registros de Promociones</a>
                      </li>
          
                      
          
          
          
                    <li class="nav-item">
                      <a class="nav-link" href="/metodopago">Metodo de Pago</a>
                      </li>
          
          
          
                      <li class="nav-item">
                        <a class="nav-link" href="/sartabla">SAR</a>
                        </li>
          
              
                </ul>
                </li>
              </ul>
              </div>
          
          
          
              <div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
                <ul class="navbar-nav">
                <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Vista productos
                </a>
                <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
              
                  <li class="nav-item">
                  <a class="nav-link" href="/categoria">Registros de categoria</a>
                  </li>
              
                  <li class="nav-item">
                  <a class="nav-link" href="/almacen">Registros del almacen </a>
                  </li>
          
                  <li class="nav-item">
                  <a class="nav-link" href="/familiaproducto">Registros de familia producto</a>
                  </li>
          
                  <li class="nav-item">
                  <a class="nav-link" href="/menutabla">Registros del Menu</a>
                  </li>
          
          
                  <li class="nav-item">
                    <a class="nav-link" href="/historicomenutabla">Registros Historicos del Menu</a>
                    </li>
          
                  <li class="nav-item">
                  <a class="nav-link" href="/elaboracion">Registros de Elaboracion</a>
                  </li>
          
          
                  <li class="nav-item">
                  <a class="nav-link" href="/recetatablaregistros">Registros de Receta</a>
                  </li>
          
                  <li class="nav-item">
                    <a class="nav-link" href="/inventario">Registros de inventario</a>
                    </li>
          
                  <li class="nav-item">
                    <a class="nav-link" href="/productos">Registros de Productos</a>
                    </li>
          
                    <li class="nav-item">
                        <a class="nav-link" href="/historicoproducto">Registros Historicos de Productos</a>
                        </li>

                    
                    <li class="nav-item">
                        <a class="nav-link" href="/provedores">Registros de Proveedores</a>
                        </li>
              
          
              
                </ul>
                </li>
                </ul>
                </div>
              
            
            
            
            
              <li class="nav-item">
              <a class="nav-link" href="/signout">Cerrar Sesion</a>
              </li>
            
            
            
             
              {% else %}
              
              <li class="nav-item">
              <a class="nav-link" href="/login_user">Iniciar Sesion</a>
              </li>
               
            
                 <li class="nav-item">
              <a class="nav-link" href="/signup">Registrarse</a>
              </li>
            
            
              
              {% endif %}
              
              
            
            
            
              
            
                 <li class="nav-item">
              <a class="nav-link" href="/menu">Menu</a>
              </li>
            
              
            
              <div class="collapse navbar-collapse" id="navbarNav">
              <li class="nav-item">
                <a class="nav-link desactivated">{{request.session.username}}</a>
              </li>
              </div>
            
            
              </ul>
              </div>
            </div>
            </nav>
        

                <h1>Control de Reservaciones</h1>





<div id="restaurante" > <img id="img-restaurant" src="../static/images/restaurantfloorplant.JPG" alt="">

<div id="mesas">

</div>
</div>

<div class="d-flex justify-content-center">
    <div class="col-auto">  
  <label for="num-mesas">Número de Reservaciones:</label>
  <input class="form-control" type="number" id="num-mesas">
</div>
<div class="col-auto">
  <button class="btn btn-success" id="generar-button">Generar</button>
</div>

<div class="col-auto">

<button class="btn btn-danger" id="reset-button">Resetear</button>
</div>

<div class="col-auto">

<button class="btn btn-info" id="eliminar-mesas-button">Eliminar</button>
</div>
</div>

<button class="btn btn-danger" id="capturar-imagen">GENERAR CAPTURA</button>




<!-- Button trigger modal de Agregar Modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#GuardarReservacionModal">
    Agregar Nueva Reservacion
  </button>


  

<table id="myTable" class="display" cellspacing="0" width="100%">
    <thead>
    <tr>
    <th>ID</th>
    <th>Nombre del Reservante</th>
    <th>Nombre del Sucursal</th>
    <th>Numero de Mesas Reservadas</th>
    <th>Fecha de inicio de la reserva</th>
    <th>Fecha de Llegada a la reserva</th>
    <th>Descripcion</th>
    <th>Acciones</th>
    
</tr>
    </thead>
    <tfoot>
        <tr>
            <th>ID</th>
            <th>Nombre del Reservante</th>
            <th>Nombre del Sucursal</th>
            <th>Numero de Mesas Reservadas</th>
            <th>Fecha de inicio de la reserva</th>
            <th>Fecha de Llegada a la reserva</th>
            <th>Descripcion</th>
            <th>Acciones</th>
        </tr>
            </tfoot>
    
    <tbody>
      {% for r in res %}
    <tr>
    <td>{{ r.id_reservacion }}</td>
    <td>{{ r.nombre_reservante }}</td>
    <td>{{ r.nombre_sucursal }}</td>
    <td>{{ r.numero_mesas }}</td>
    <td>{{ r.fecha_reserva|date:"d/m/Y" }}</td>
    <td>{{ r.fecha_llegada|date:"d/m/Y" }}</td>
    <td>{{ r.descripcion }}</td>
    <td>
       <!-- Button trigger modal de Agregar Modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#EditarReservacionModal-{{forloop.counter}}">
 EDITAR
</button>
        <a href="/eliminarreservacion/{{ r.id_reservacion }}" class="btn btn-danger">ELIMINAR</a>
    </td>

</tr>
{% endfor %}
</tbody>
</table>


  <!-- Modal -->
  <div class="modal fade" id="GuardarReservacionModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Agregar Reservacion</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form id="Myform" action="{% url 'agregarreservacion' %}" method="POST">
          {% csrf_token %}
        <div class="modal-body">

   
          




          <div class="form-group ">

                 
            <label for=""> ID de la Reservacion </label>
                 <input class="form-select" id="id_reservacion" name="id_reservacion" placeholder="Introduce el ID de la reservacion" type="text"/>
                </div>
              </div>
        
                
                
              
              <label for=""> Nombre del reservante </label>
                <select class="form-control" name="nombre_reservante" id="nombre_reservante" >
                  <option value="" selected disabled>Escoge un Reservante</option>
                  {% for u in user %}
                  <option class="form-select" value="{{u.nombre}}">{{u.nombre}}</option>
                  {% endfor %}
                </select>
               
          
                <div class="form-group">
                  <label for=""> Nombre de la Sucursal </label>
                  <select class="form-control" name="nombre_sucursal" id="nombre_sucursal" >
                      <option value="" >Selecciona una Sucursal</option>
                      {% for s in sucu %}
                          <option class="form-select" value="{{s.direccion_sucursal}}">{{s.direccion_sucursal}}</option>
                      {% endfor %}
                  </select>
              </div>
             
               

                
                <label for=""> Numero de Reservaciones </label>
                <select class="form-control" name="numero_mesas" id="numero_mesas" >
                  <option value="" selected disabled>Selecciona el Numero de Reservaciones</option>

                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                
                
              </select>
              
                <div class="form-group ">

                  <label for=""> Fecha de inicio de La Reserva </label>
              <input class="form-control" id="fecha_reserva" name="fecha_reserva" min="2023-03-26"  type="date" />
            </div>

              <div class="form-group ">
                <label for=""> Fecha de Llegada a la Reserva </label>
            <input class="form-control" id="fecha_llegada" name="fecha_llegada" min="2023-03-26"    type="date" />
          </div>

          <div class="mb-3">
            <label for="exampleFormControlTextarea1" class="form-label">Descripcion del Reservante</label>
            <textarea name="descripcion" class="form-control" id="descripcion" rows="3" minlength="10" maxlength="250" ></textarea>
          </div>


  
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button type="submit" class="btn btn-primary">Guardar Cambios</button>
        </div>
      </form>
      </div>
  
    </div>
  </div>



  <!-- Modal EDITAR -->
  {% for r in res %}
  <div class="modal fade" id="EditarReservacionModal-{{forloop.counter}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">EDITAR RESERVACION</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="/editarreservacion/{{ r.id_reservacion }}" method="POST">
          {% csrf_token %}
        <div class="modal-body">

   
          




          <div class="form-group ">

                 
            <label for=""> ID de la Reservacion </label>
                 <input class="form-select" value="{{ r.id_reservacion }}" id="id_reservacion" name="id_reservacion" placeholder="Introduce el ID de la reservacion" type="text"/>
                </div>
              </div>
        
                
                
              
              <label for=""> Nombre del reservante </label>
                <select class="form-control" name="nombre_reservante" id="nombre_reservante">
                  <option value="{{r.nombre_reservante}}">{{r.nombre_reservante}}</option>
                  {% for u in user %}
                  <option class="form-select" value="{{u.nombre}}">{{u.nombre}}</option>
                  {% endfor %}
                </select>
               
          

                <label for=""> Nombre de la Sucursal </label>
                <select class="form-control" name="nombre_sucursal" id="nombre_sucursal">
                  <option value="{{r.nombre_sucursal}}">{{r.nombre_sucursal}}</option>
                  {% for s in sucu %}

                <option class="form-select" value="{{s.direccion_sucursal}}">{{s.direccion_sucursal}}

                </option>
                {% endfor %}
                </select>
             
               

                
                <label for=""> Numero de Reservaciones </label>
                <select class="form-control" name="numero_mesas" id="numero_mesas">
                  <option value="{{ r.numero_mesas }}">{{ r.numero_mesas }}</option>

                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                
                
              </select>
              
                <div class="form-group ">

                  <label for=""> Fecha de inicio de La Reserva </label>
              <input class="form-control" id="fecha_reserva" name="fecha_reserva" value="{{ r.fecha_reserva|date:'Y-m-d' }}"  type="date"/>
            </div>

              <div class="form-group ">
                <label for=""> Fecha de Llegada a la Reserva </label>
            <input class="form-control" id="fecha_llegada" name="fecha_llegada" value="{{ r.fecha_llegada|date:'Y-m-d' }}"  type="date"/>
          </div>

          <div class="mb-3">
            <label for="exampleFormControlTextarea1" class="form-label">Descripcion del Reservante</label>
            <textarea name="descripcion" value="{{ r.descripcion }}"  class="form-control" id="exampleFormControlTextarea1" rows="3">{{ r.descripcion }}</textarea>
          </div>


  
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button type="submit" class="btn btn-primary">Guardar Cambios</button>
        </div>
      </form>
      </div>
  
    </div>
  </div>

  {% endfor %}





  <script>
$("#capturar-imagen").click(function() {
  html2canvas(document.querySelector("#restaurante")).then(function(canvas) {

    // Crear un nuevo canvas del mismo tamaño que el canvas original
    var newCanvas = document.createElement("canvas");
    newCanvas.width = canvas.width;
    newCanvas.height = canvas.height;

    // Dibujar la imagen original en el nuevo canvas
    var context = newCanvas.getContext('2d');
    context.drawImage(canvas, 0, 30);

    // Dibujar el título encima de la imagen
    var title = "Pizza Wave Reservaciones";
    context.font = "24px Script";
    context.fillStyle = "#000";
    context.fillText(title, 12, 30);

    // Convertir el nuevo canvas a una URL de imagen
    var imgURL = newCanvas.toDataURL("image/png");

    // Crear un enlace de descarga
    var link = document.createElement("a");
    link.href = imgURL;
    link.download = "restaurante.png";

    // Agregar el enlace al documento y hacer clic en él
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  });
});





    $(document).ready(function() {
    $('#myTable').DataTable({
    "language": {
    "url": "//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json"
    }
    });
    })
    
    
                    $(document).ready(function() {
                      function generarMesas(cantidad) {
                        // Agregar las nuevas mesas al final de las existentes
                        for (var i = 1; i <= cantidad; i++) {
                          var mesa = $("<div>", {
                            "class": "mesa",
                            "text": $(".mesa").length + 1
                          });
                          $("#mesas").append(mesa);
                          mesa.draggable({
                            containment: "#restaurante",
                            scroll: false
                          });
                        }
                      }
                  
                      $("#generar-button").click(function() {
                        var cantidad = parseInt($("#num-mesas").val());
                        if (isNaN(cantidad) || cantidad < 1 || cantidad > 10) {
                          alert("Ingrese un número válido de mesas (entre 1 y 10).");
                          return;
                        }
                        generarMesas(cantidad);
                      });
                  
                      $("#reset-button").click(function() {
      $("#mesas").html('');
      for (var i = 1; i <= cantidadMesas; i++) {
        $("#mesas").append('<div class="mesa">' + i + '</div>');
      }
      $(".mesa").draggable({
        containment: "#restaurante",
        scroll: false
      });
    });
    
    
                        // Función para eliminar las mesas
      function eliminarMesas() {
        $(".mesa").remove();
      }
      
      // Configuramos el botón de eliminar mesas
      $("#eliminar-mesas-button").click(function() {
      $(".mesa").last().remove();
    });
    

  
    
    
    $("#Myform").validate({
    rules: {
        id_reservacion: {
            required: true,
            noSpaceafterletters: true,
        },
        nombre_reservante: {
            required: true,
        },
        nombre_sucursal: {
            required: true,
        },
        numero_mesas: {
            required: true,
        },
        fecha_reserva: {
            required: true,
            
            lessEqualThan: "#fecha_llegada" 
        },

        fecha_llegada: {
            required: true,
            greaterEqualThan: "#fecha_reserva" 
        },
        descripcion: {
            required: true,
            noSpace: true,
            minlength: 10,
            maxlength: 250,
        },
    },
    messages: {
        id_reservacion: {
            noSpace: "No se puede Espacios Estimado",
            required: "Debes Poner un ID",
        },
        nombre_reservante: {
            required: "Debes Seleccionar El nombre del Reservante",
        },
        nombre_sucursal: {
            required: "Debes Seleccionar Una Sucursal",
        },
        numero_mesas: {
            required: "Debes Seleccionar el Numero de Reservaciones Hechas",
        },
        fecha_reserva: {
            required: "Debes seleccionar la fecha de Reserva",
        },
        fecha_llegada: {
            required: "Debes Seleccionar la Fecha de llegada",
            min: "La Fecha de llegada no puede ser anterior a la Fecha de Reserva",
            max: "La Fecha de llegada no puede ser posterior a la Fecha de Inicio"
        },
        fecha_inicio: {
            required: "Debes Seleccionar la Fecha de Inicio",
            min: "La Fecha de Inicio no puede ser anterior a la Fecha de Reserva",
            max: "La Fecha de Inicio no puede ser posterior a la Fecha de llegada"
        },
        descripcion: {
            required: "Debes Escribir una Minima Descripcion de la Reserva",
        },
    },
    submitHandler: function(form) {
          $("#mensaje-confirmacion").show();
          form.submit();
        }
});

      
// Agrega regla personalizada para validar que la fecha sea mayor o igual que otra fecha
$.validator.addMethod('greaterEqualThan', function(value, element, param) {
  var otherDate = $(param).val();
  if (!value || !otherDate) {
    return true;
  }
  return new Date(value) >= new Date(otherDate);
}, 'La fecha de Llegada debe ser mayor o igual que la fecha de Reserva.');

// Agrega regla personalizada para validar que la fecha sea menor o igual que otra fecha
$.validator.addMethod('lessEqualThan', function(value, element, param) {
  var otherDate = $(param).val();
  if (!value || !otherDate) {
    return true;
  }
  return new Date(value) <= new Date(otherDate);
}, 'La fecha de Inicio debe ser menor o igual que la fecha de Llegada.');

    
        jQuery.validator.addMethod("noSpace", function(value, element) { 
        return value == '' || value.trim().length != 0;  
      }, "No espacios Porfavor Eso no se Hace Aqui");
      
      // Regla personalizada para validar el campo de nombre_cargo
      $.validator.addMethod("noRepetidos", function(value, element) {
        return this.optional(element) || !/(.)\1+/.test(value);
      }, "No se permiten caracteres repetidos en este campo");
      
      jQuery.validator.addMethod("noSpaceafterletters", function(value, element) { 
        return this.optional(element) || /^[^\s]+\s*[^\s]*$/.test(value);
    }, "No letras ni digitos despues de espacios por favor");
    
    
                
                    });
    
                  </script>
    




</body>
        
    </html>
